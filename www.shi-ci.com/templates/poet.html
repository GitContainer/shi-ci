{% include 'templates/_header.html' %}

<script type="text/javascript">
$(function() {
    var normal_text = $('#more').text();
    $('#more').click(function() {
        var page = parseInt($('#more').attr('page'));
        $('#more').attr('disabled', 'disabled').text('正在获取更多诗词，请稍候……').addClass('loading');
        $.getJSON('/more/poems?poet_id={{ poet.id }}&page=' + page)
         .done(function(result) {
            if (result.next) {
                page = page + 1;
                $('#more').attr('page', '' + page);
                $('#more').text(normal_text);
            }
            else {
                $('#more').hide();
            }
            var boxes = $(make_poem_boxes(result.poems));
            $('#poems').append(boxes).masonry('appended', boxes);
        }).fail(function() {
            $('#more').text('网络好像出问题了，点击重试一次');
        }).always(function() {
            $('#more').removeAttr('disabled').removeClass('loading');
        });
    });
});
</script>

    <div class="container">
        <div class="row">
            <div class="frame">
                <div class="frame-inner">
                    <div>
                        <form id="search" name="search" action="#" method="get">
                            在六万余首诗词中搜索：<input name="q" type="text" maxlength="15" class="search" placeholder="请输入关键词" /> <button class="btn">搜索</button>
                        </form>
                    </div>
                    <div class="condition condition-poet">诗人：<span>所有</span> <span v="{{ poet.id }}" class="selected">{{ poet.name }}</span></div>
                    <div class="condition">格式：<span class="selected">不限</span> <span>五律</span> <span>五绝</span> <span>七律</span> <span>七绝</span> <span>词</span> <span>曲</span> <span>赋</span></div>
                </div>
            </div>
        </div>
        <div class="row">
            <div id="poems">
{% for p in poems %}
                <div class="item">
                    <div class="item-header"></div>
                    <div class="item-body">
                        <p><a href="/poem/{{ p.id }}">{{ p.name }}</a></p>
                        <p>{{ p.content }}</p>
                    </div>
                    <div class="item-footer"></div>
                </div>
{% endfor %}
            </div>
        </div>
{% if next %}
        <div class="row">
            <div class="more">
                <button id="more" page="2" class="btn">显示更多诗词</button>
            </div>
        </div>
{% endif %}
    </div>
{% include 'templates/_footer.html' %}
